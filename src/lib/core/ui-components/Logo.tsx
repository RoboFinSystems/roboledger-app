import { CURRENT_APP } from '../auth-core/config'
import type { AppName } from '../auth-core/types'

export interface AnimatedLogoProps {
  className?: string
  animate?: 'once' | 'loop'
  app?: AppName
}

/* Graph nodes (shared across all three logos) */
function GraphNodes() {
  return (
    <g transform="matrix(2.49868,0,0,2.59811,-747.255,-135.521)">
      <g transform="matrix(0.517664,0.499902,-1.04482,1.08194,387.843,-253.483)">
        <rect x="451.017" y="150.798" width="53.143" height="13.689" />
      </g>
      <g transform="matrix(-5.28647e-17,-0.5334,1.60446,-4.68862e-17,255.339,491.11)">
        <rect x="451.017" y="150.798" width="53.143" height="13.689" />
      </g>
      <g transform="matrix(0.549336,-0.58909,1.13654,1.05985,100.455,264.271)">
        <rect x="451.017" y="150.798" width="53.143" height="13.689" />
      </g>
      <g transform="matrix(1,0,0,1.05096,177.322,-5.45629)">
        <path d="M250.672,80.255C272.88,80.255 290.91,97.31 290.91,118.316C290.91,139.322 272.88,156.376 250.672,156.376C228.464,156.376 210.433,139.322 210.433,118.316C210.433,97.31 228.464,80.255 250.672,80.255ZM250.672,99.286C261.776,99.286 270.791,107.813 270.791,118.316C270.791,128.819 261.776,137.346 250.672,137.346C239.568,137.346 230.553,128.819 230.553,118.316C230.553,107.813 239.568,99.286 250.672,99.286Z" />
      </g>
      <g transform="matrix(0.869818,0,0,0.919587,289.117,82.161)">
        <path d="M250.672,80.255C272.88,80.255 290.91,97.31 290.91,118.316C290.91,139.322 272.88,156.376 250.672,156.376C228.464,156.376 210.433,139.322 210.433,118.316C210.433,97.31 228.464,80.255 250.672,80.255ZM250.672,99.286C261.776,99.286 270.791,107.813 270.791,118.316C270.791,128.819 261.776,137.346 250.672,137.346C239.568,137.346 230.553,128.819 230.553,118.316C230.553,107.813 239.568,99.286 250.672,99.286Z" />
      </g>
      <g transform="matrix(1,0,0,1.05096,331.465,-18.1536)">
        <path d="M250.672,80.255C272.88,80.255 290.91,97.31 290.91,118.316C290.91,139.322 272.88,156.376 250.672,156.376C228.464,156.376 210.433,139.322 210.433,118.316C210.433,97.31 228.464,80.255 250.672,80.255ZM250.672,99.286C261.776,99.286 270.791,107.813 270.791,118.316C270.791,128.819 261.776,137.346 250.672,137.346C239.568,137.346 230.553,128.819 230.553,118.316C230.553,107.813 239.568,99.286 250.672,99.286Z" />
      </g>
    </g>
  )
}

/* Shared book structure elements */
function BookBase() {
  return (
    <>
      {/* Book left page top */}
      <g transform="matrix(1.11678,0.257829,-0.100241,0.43419,24.5867,227.367)">
        <path d="M494.703,576.843L494.703,600.541C494.703,613.235 490.553,623.542 485.443,623.542L347.276,623.542C342.165,623.542 338.016,613.235 338.016,600.541L338.016,576.843C338.016,564.149 342.165,553.843 347.276,553.843L485.443,553.843C490.553,553.843 494.703,564.149 494.703,576.843Z" />
      </g>
      {/* Book left side */}
      <g transform="matrix(6.90144e-17,-1.14962,0.464321,-2.15344e-17,77.8997,1125.4)">
        <path d="M494.703,588.692C494.703,607.926 488.637,623.542 481.166,623.542L351.553,623.542C344.082,623.542 338.016,607.926 338.016,588.692C338.016,569.458 344.082,553.843 351.553,553.843L481.166,553.843C488.637,553.843 494.703,569.458 494.703,588.692Z" />
      </g>
      {/* Book right side */}
      <g transform="matrix(6.88291e-17,-1.14663,0.464321,-2.14054e-17,388.521,1125.53)">
        <path d="M494.703,588.692C494.703,607.926 488.621,623.542 481.131,623.542L351.588,623.542C344.098,623.542 338.016,607.926 338.016,588.692C338.016,569.458 344.098,553.843 351.588,553.843L481.131,553.843C488.621,553.843 494.703,569.458 494.703,588.692Z" />
      </g>
      {/* Book left page */}
      <g transform="matrix(1.12437,0.301274,-0.118553,0.442447,31.5589,355.851)">
        <path d="M494.703,571.267L494.703,606.117C494.703,615.734 491.525,623.542 487.612,623.542L345.107,623.542C341.193,623.542 338.016,615.734 338.016,606.117L338.016,571.267C338.016,561.65 341.193,553.843 345.107,553.843L487.612,553.843C491.525,553.843 494.703,561.65 494.703,571.267Z" />
      </g>
      {/* Book right page */}
      <g transform="matrix(1.08457,-0.29061,0.117114,0.437076,64.1786,606.532)">
        <path d="M494.703,571.267L494.703,606.117C494.703,615.734 491.449,623.542 487.441,623.542L345.278,623.542C341.27,623.542 338.016,615.734 338.016,606.117L338.016,571.267C338.016,561.65 341.27,553.843 345.278,553.843L487.441,553.843C491.449,553.843 494.703,561.65 494.703,571.267Z" />
      </g>
      {/* Book top connector */}
      <g transform="matrix(1.11035,-0.256345,0.0986939,0.42749,65.4073,446.414)">
        <path d="M494.703,585.207L494.703,592.177C494.703,609.488 489.1,623.542 482.198,623.542L350.521,623.542C343.619,623.542 338.016,609.488 338.016,592.177L338.016,585.207C338.016,567.897 343.619,553.843 350.521,553.843L482.198,553.843C489.1,553.843 494.703,567.897 494.703,585.207Z" />
      </g>
    </>
  )
}

/* RoboInvestor: bar chart animation */
function InvestorBook({ animate }: { animate: 'once' | 'loop' }) {
  const isOnce = animate === 'once'
  const animName = isOnce ? 'barIntro' : 'barWave'
  const iteration = isOnce ? '1' : 'infinite'
  const fillMode = isOnce ? 'forwards' : 'none'

  return (
    <>
      <style>{`
        .ri-bar {
          transform-box: fill-box;
          transform-origin: 0% 50%;
          animation: ${animName} 1.4s ease-in-out ${iteration} ${fillMode};
        }
        .ri-bar-1 { animation-delay: 0s; }
        .ri-bar-2 { animation-delay: 0.15s; }
        .ri-bar-3 { animation-delay: 0.3s; }
        @keyframes barWave {
          0%, 100% { transform: scaleX(0.3); }
          50% { transform: scaleX(1); }
        }
        @keyframes barIntro {
          0% { transform: scaleX(0.3); }
          60% { transform: scaleX(1.1); }
          100% { transform: scaleX(1); }
        }
      `}</style>
      <g transform="matrix(2.49868,0,0,2.59811,-751.016,-1032.21)">
        <BookBase />
        {/* Bar 1 (short) */}
        <g transform="matrix(-1.05969e-17,-0.395984,0.462394,-0.00760872,191.313,902.146)">
          <g className="ri-bar ri-bar-1">
            <path d="M494.703,576.843L494.703,600.541C494.703,613.235 483.129,623.542 468.873,623.542L363.846,623.542C349.59,623.542 338.016,613.235 338.016,600.541L338.016,576.843C338.016,564.149 349.59,553.843 363.846,553.843L468.873,553.843C483.129,553.843 494.703,564.149 494.703,576.843Z" />
          </g>
        </g>
        {/* Bar 2 (medium) */}
        <g transform="matrix(-4.01651e-17,-0.572815,0.462394,-0.00760872,236.173,953.952)">
          <g className="ri-bar ri-bar-2">
            <path d="M494.703,576.843L494.703,600.541C494.703,613.235 486.702,623.542 476.846,623.542L355.872,623.542C346.017,623.542 338.016,613.235 338.016,600.541L338.016,576.843C338.016,564.149 346.017,553.843 355.872,553.843L476.846,553.843C486.702,553.843 494.703,564.149 494.703,576.843Z" />
          </g>
        </g>
        {/* Bar 3 (tall) */}
        <g transform="matrix(-8.47906e-17,-0.839696,0.462394,-0.00760872,281.533,1053.03)">
          <g className="ri-bar ri-bar-3">
            <path d="M494.703,576.843L494.703,600.541C494.703,613.235 489.245,623.542 482.522,623.542L350.197,623.542C343.474,623.542 338.016,613.235 338.016,600.541L338.016,576.843C338.016,564.149 343.474,553.843 350.197,553.843L482.522,553.843C489.245,553.843 494.703,564.149 494.703,576.843Z" />
          </g>
        </g>
        {/* Spine center */}
        <g transform="matrix(-1.89816e-17,-0.22431,0.431709,1.61811e-17,255.945,699.671)">
          <path d="M494.703,588.692C494.703,607.926 465.799,623.542 430.198,623.542L402.521,623.542C366.92,623.542 338.016,607.926 338.016,588.692C338.016,569.458 366.92,553.843 402.521,553.843L430.198,553.843C465.799,553.843 494.703,569.458 494.703,588.692Z" />
        </g>
      </g>
    </>
  )
}

/* RoboLedger: T-account eyes wink */
function LedgerBook({ animate }: { animate: 'once' | 'loop' }) {
  const isOnce = animate === 'once'
  const iteration = isOnce ? '1' : 'infinite'
  const fillMode = isOnce ? 'forwards' : 'none'

  return (
    <>
      <style>{`
        .rl-eye-l {
          animation: ${isOnce ? 'winkIntroL' : 'winkL'} ${isOnce ? '1.2s' : '2s'} ease-in-out ${iteration} ${fillMode};
        }
        .rl-eye-r {
          animation: ${isOnce ? 'winkIntroR' : 'winkR'} ${isOnce ? '1.2s' : '2s'} ease-in-out ${iteration} ${fillMode};
        }
        @keyframes winkL {
          0%, 15%, 30%, 100% { opacity: 1; }
          5%, 12% { opacity: 0; }
        }
        @keyframes winkR {
          0%, 45%, 65%, 100% { opacity: 1; }
          50%, 60% { opacity: 0; }
        }
        @keyframes winkIntroL {
          0% { opacity: 0; }
          30% { opacity: 1; }
          45% { opacity: 0; }
          60%, 100% { opacity: 1; }
        }
        @keyframes winkIntroR {
          0% { opacity: 0; }
          50% { opacity: 1; }
          65% { opacity: 0; }
          80%, 100% { opacity: 1; }
        }
      `}</style>
      <g transform="matrix(2.49868,0,0,2.59811,-751.016,-1032.21)">
        <BookBase />
        {/* Vertical divider */}
        <g transform="matrix(4.36382e-17,-1.20783,0.431709,-2.43413e-17,255.145,1185.07)">
          <path d="M494.703,576.843L494.703,600.541C494.703,613.235 491.16,623.542 486.796,623.542L345.922,623.542C341.559,623.542 338.016,613.235 338.016,600.541L338.016,576.843C338.016,564.149 341.559,553.843 345.922,553.843L486.796,553.843C491.16,553.843 494.703,564.149 494.703,576.843Z" />
        </g>
        {/* Left eye (T-account line) */}
        <g transform="matrix(0.555228,-0.128184,0.0544276,0.235752,324.508,560.439)">
          <g className="rl-eye-l">
            <path d="M494.703,588.218L494.703,589.166C494.703,608.138 487.93,623.542 479.588,623.542L353.131,623.542C344.789,623.542 338.016,608.138 338.016,589.166L338.016,588.218C338.016,569.246 344.789,553.843 353.131,553.843L479.588,553.843C487.93,553.843 494.703,569.246 494.703,588.218Z" />
          </g>
        </g>
        {/* Right eye (T-account line) */}
        <g transform="matrix(0.555228,0.128184,-0.0544276,0.235752,231.691,453.111)">
          <g className="rl-eye-r">
            <path d="M494.703,588.218L494.703,589.166C494.703,608.138 487.93,623.542 479.588,623.542L353.131,623.542C344.789,623.542 338.016,608.138 338.016,589.166L338.016,588.218C338.016,569.246 344.789,553.843 353.131,553.843L479.588,553.843C487.93,553.843 494.703,569.246 494.703,588.218Z" />
          </g>
        </g>
      </g>
    </>
  )
}

/* RoboSystems: infinity S with segment tracing the figure-8 */
function SystemsBook({ animate }: { animate: 'once' | 'loop' }) {
  const isOnce = animate === 'once'
  const motionPath =
    'M 16,16 C 22,8 32,10 30,16 C 28,22 22,24 16,16 C 10,8 0,10 2,16 C 4,22 10,24 16,16'
  const infinityPath =
    'M0,16C0,17.664 0.405,19.2 1.216,20.608C2.027,22.016 3.136,23.125 4.544,23.936C5.952,24.747 7.488,25.152 9.152,25.152C10.155,25.152 11.179,24.96 12.224,24.576C11.243,23.36 10.485,22.005 9.952,20.512C9.589,20.555 9.323,20.576 9.152,20.576C7.893,20.576 6.816,20.128 5.92,19.232C5.024,18.336 4.576,17.259 4.576,16C4.576,14.741 5.024,13.664 5.92,12.768C6.816,11.872 7.893,11.424 9.152,11.424C10.411,11.424 11.488,11.872 12.384,12.768C13.28,13.664 13.728,14.741 13.728,16C13.728,17.664 14.133,19.2 14.944,20.608C15.755,22.016 16.864,23.125 18.272,23.936C19.68,24.747 21.205,25.152 22.848,25.152C24.491,25.152 26.027,24.747 27.456,23.936C28.885,23.125 29.995,22.016 30.784,20.608C31.573,19.2 31.979,17.664 32,16C32.021,14.336 31.616,12.811 30.784,11.424C29.952,10.037 28.843,8.928 27.456,8.096C26.069,7.264 24.533,6.859 22.848,6.88C21.845,6.88 20.821,7.061 19.776,7.424C20.757,8.64 21.515,10.005 22.048,11.52C22.411,11.456 22.677,11.424 22.848,11.424C24.107,11.424 25.184,11.872 26.08,12.768C26.976,13.664 27.424,14.741 27.424,16C27.424,17.28 26.976,18.368 26.08,19.264C25.184,20.16 24.107,20.597 22.848,20.576C21.589,20.576 20.512,20.139 19.616,19.264C18.72,18.389 18.272,17.301 18.272,16C18.272,14.357 17.867,12.832 17.056,11.424C16.245,10.016 15.136,8.907 13.728,8.096C12.32,7.285 10.795,6.88 9.152,6.88C7.509,6.88 5.973,7.285 4.544,8.096C3.115,8.907 2.005,10.016 1.216,11.424C0.427,12.832 0.021,14.357 -0,16Z'

  return (
    <>
      <g transform="matrix(2.49868,0,0,2.59811,-751.016,-1032.21)">
        <BookBase />
        {/* Spine center */}
        <g transform="matrix(-1.89816e-17,-0.22431,0.431709,1.61811e-17,255.945,699.671)">
          <path d="M494.703,588.692C494.703,607.926 465.799,623.542 430.198,623.542L402.521,623.542C366.92,623.542 338.016,607.926 338.016,588.692C338.016,569.458 366.92,553.843 402.521,553.843L430.198,553.843C465.799,553.843 494.703,569.458 494.703,588.692Z" />
        </g>
      </g>
      {/* Infinity S — visible segment traces the figure-8 */}
      <g transform="matrix(12.8263,0,0,13.3096,313.735,516.868)">
        {/* Base — starts solid, fades to faint once trace begins */}
        <path d={infinityPath} style={{ fillRule: 'nonzero' }}>
          {isOnce ? (
            <animate
              attributeName="opacity"
              values="1;0.15;0.15;1"
              keyTimes="0;0.1;0.8;1"
              dur="1.4s"
              fill="freeze"
            />
          ) : (
            <animate
              attributeName="opacity"
              values="1;0.15"
              dur="0.3s"
              fill="freeze"
            />
          )}
        </path>
        {/* Bright segment revealed by mask */}
        <defs>
          <mask
            id={isOnce ? 'rs-trace-once' : 'rs-trace-loop'}
            maskUnits="userSpaceOnUse"
            x="-2"
            y="5"
            width="36"
            height="22"
          >
            <rect x="-2" y="5" width="36" height="22" fill="black" />
            <circle r="8" fill="white">
              <animateMotion
                dur={isOnce ? '1.4s' : '1.2s'}
                repeatCount={isOnce ? '1' : 'indefinite'}
                fill="freeze"
                path={motionPath}
              />
            </circle>
          </mask>
        </defs>
        <path
          d={infinityPath}
          mask={`url(#${isOnce ? 'rs-trace-once' : 'rs-trace-loop'})`}
          style={{ fillRule: 'nonzero' }}
        />
      </g>
    </>
  )
}

export function AnimatedLogo({
  className,
  animate = 'loop',
  app = CURRENT_APP,
}: AnimatedLogoProps) {
  return (
    <svg
      viewBox="0 0 1024 1024"
      fill="currentColor"
      className={className}
      role="img"
      aria-label="Loading"
      style={{ fillRule: 'evenodd', clipRule: 'evenodd' }}
      shapeRendering="geometricPrecision"
    >
      {app === 'roboinvestor' && <InvestorBook animate={animate} />}
      {app === 'roboledger' && <LedgerBook animate={animate} />}
      {app === 'robosystems' && <SystemsBook animate={animate} />}
      <GraphNodes />
    </svg>
  )
}
